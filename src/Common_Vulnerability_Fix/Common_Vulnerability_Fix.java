package Common_Vulnerability_Fix;

//import packages needed for program
import java.io.BufferedReader;
import java.io.IOException;
import java.io.FileInputStream;
import java.io.InputStreamReader;

/**
 * Date: 3/24/18
 * Class:
 * Author: ATG8
 * Purpose: This application is designed to fix problems found with the original
 *          java application provided for this homework assignment.
 */
public final class Common_Vulnerability_Fix {

    /**
     * @param args the command line arguments
     */
    public static void main(String[] args) {
        // If no filename is provided or filename is less than 4 characters,
        // terminate program
        if(args.length == 0 || args[0].trim().length() < 4){
               System.out.println("You will need to provide a valid filename.");
               System.exit(0);
        }
        
        // Read the filename from the command line argument into a string
        String filename = args[0];
        
        // Check that filename has a ".txt" extension
        String extFilename = filename.substring(filename.length() - 4);
        if(!".txt".equals(extFilename)){
            System.out.println("You need to provide a .txt filename.");
            System.exit(0);
        }
        
        // Try buffered reader and catch all exceptions
        try {
            final FileInputStream stream = new FileInputStream(filename);
            try{
                final BufferedReader bufRead =
                        new BufferedReader(new InputStreamReader(stream));

                // Print header then read each line
                System.out.println("Email Addresses:");
                // convert each line into string and output each string
                String line;
                while ((line = bufRead.readLine()) != null) {
                    System.out.println(line);
                }
            // finally block to close stream
            } finally {
                if(stream != null){
                    try{
                        stream.close();
                    // catch exception while closing file
                    }catch (IOException e){
                        System.out.println("File IO exception "
                                + e.getMessage());
                    }
                }
            }
        // catch balance of io exceptions
        } catch (IOException io) {
            System.out.println("File IO exception " + io.getMessage());
        }
    }

}
